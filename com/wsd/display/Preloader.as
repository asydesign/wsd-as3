package com.wsd.display{	import com.adobe.images.JPGEncoder;		import com.wsd.Base;	import com.wsd.View;		import flash.display.Loader;	import flash.events.Event;	import flash.net.URLRequest;	import flash.display.Bitmap;	import flash.display.MovieClip;		public class Preloader extends View	{		private static var _$	:Preloader;		public var loaded:Boolean = false;				public function Preloader()		{		}				public function load(imagesArr:Array):void		{			var loaders:Array = [];						for (var i:String in imagesArr)			{				//Base.log('Preloader::load(name: ' + i + ' url: ' + imagesArr[i] + ')');				var loader:Object = new Object;								if (typeof(imagesArr[i]) == 'object')				{					loader.path = imagesArr[i].path;					loader.code = imagesArr[i].name;				} else {					loader.path = imagesArr[i];					loader.code = i;				}								loaders.push(loader);			}						backgroundLoader(loaders);		}				public function backgroundLoader(loaders:Array):void		{			Base.log('Preloader::backgroundLoader(left: ' + loaders.length + ')');						if (loaders.length == 0) {				loaded = true;				return;			}						var data:Object = loaders.shift();			var request:URLRequest = new URLRequest(data.path);			var loader:Loader = new Loader();			loader.name = data.code + '_loader';			loader.load(request);						var _this = this;						loader.contentLoaderInfo.addEventListener(Event.COMPLETE, function( e:Event ):void			{				Base.log('Preloader::loaded(name: ' + e.target.loader.name.replace('_loader', '') + ' left: ' + loaders.length + ')');								if(e.target.content is Bitmap) {					var clonedData:Bitmap = new Bitmap();					clonedData.bitmapData = e.target.content.bitmapData;					clonedData.name = e.target.loader.name.replace('_loader', '');					addChild(clonedData);				} else {					addChild(loader);				}								_this.backgroundLoader(loaders);			});		}				public function getImage(image:String):*		{			return this[image];		}				public function clone(code):*		{			var mc:MovieClip = new MovieClip;			var bitmap:Bitmap = new Bitmap();			Base.log('Preloader::clone(code: ' + code + ')');			bitmap.bitmapData = Bitmap(getChildByName(code)).bitmapData.clone();			mc.addChild(bitmap);			mc.name = code;			return mc;		}				public static function get $():Preloader 		{			if (!_$)				_$ = new Preloader();			return _$;		}				public static function set $(value:Preloader):void 		{			_$ = value;		}	}}